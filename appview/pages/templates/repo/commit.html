{{ define "title" }} commit {{ .Diff.Commit.This }} {{ end }}

{{ define "repoContent" }}

{{ $repo := .RepoInfo.FullName }}
{{ $commit := .Diff.Commit }}
{{ $stat := .Diff.Stat }}
{{ $diff := .Diff.Diff }}

<section class="commit">
  <div id="commit-message">
    {{ $messageParts := splitN $commit.Message "\n\n" 2 }}
    <div>
      {{ index $messageParts 0 }}
      {{ if gt (len $messageParts) 1 }}
      <p class="mt-1 cursor-text pb-2">{{ nl2br (unwrapText (index $messageParts 1)) }}</p>
      {{ end }}
    </div>
  </div>

  <p class="text-sm text-gray-500">
    <a href="mailto:{{ $commit.Author.Email }}" class="no-underline hover:underline text-gray-500">
      {{ $commit.Author.Name }}
    </a>
    &nbsp;·&nbsp;
    {{ timeFmt $commit.Author.When }}
    &nbsp;·&nbsp;
    <span class="font-mono">{{ $stat.FilesChanged }}</span> files <span class="font-mono">(+{{ $stat.Insertions }}, -{{ $stat.Deletions }})</span>
    &nbsp;·&nbsp;
    <a href="/{{ $repo }}/commit/{{ $commit.This }}" class="no-underline hover:underline text-gray-500">
      {{ slice $commit.This 0 8 }}
    </a>
    {{ if $commit.Parent }}
      &lt;--
      <a href="/{{ $repo }}/commit/{{ $commit.Parent }}" class="no-underline hover:underline text-gray-500">
        {{ slice $commit.Parent 0 8 }}
      </a>
    {{ end }}
  </p>

  <div class="diff-stat">
    <br>
    <strong>jump to</strong>
    {{ range $diff }}
    <ul>
      <li><a href="#{{ .Name.New }}">{{ .Name.New }}</a></li>
    </ul>
    {{ end }}
  </div>
</section>
<section>
  {{ $this := $commit.This }}
  {{ $parent := $commit.Parent }}
  {{ range $diff }}
    <div id="{{ .Name.New }}">
      <div class="diff">
      {{ if .IsNew }}
      <span class="diff-type">A</span>
      {{ end }}
      {{ if .IsDelete }}
      <span class="diff-type">D</span>
      {{ end }}
      {{ if not (or .IsNew .IsDelete) }}
      <span class="diff-type">M</span>
      {{ end }}
    {{ if .Name.Old }}
    <a href="/{{ $repo }}/blob/{{ $parent }}/{{ .Name.Old }}">{{ .Name.Old }}</a>
    {{ if .Name.New }}
      &#8594;
      <a href="/{{ $repo }}/blob/{{ $this }}/{{ .Name.New }}">{{ .Name.New }}</a>
    {{ end }}
    {{ else }}
    <a href="/{{ $repo }}/blob/{{ $this }}/{{ .Name.New }}">{{ .Name.New }}</a>
    {{- end -}}
    {{ if .IsBinary }}
    <p>Not showing binary file.</p>
    {{ else }}
      <pre class="overflow-auto">
      {{- range .TextFragments -}}
      <p>{{- .Header -}}</p>
      {{- range .Lines -}}
        {{- if eq .Op.String "+" -}}
        <span class="diff-add">{{ .String }}</span>
        {{- end -}}
        {{- if eq .Op.String "-" -}}
        <span class="diff-del">{{ .String }}</span>
        {{- end -}}
        {{- if eq .Op.String " " -}}
        <span class="diff-noop">{{ .String }}</span>
        {{- end -}}
      {{- end -}}
      {{- end -}}
    {{- end -}}
      </pre>
    </div>
    </div>
  {{ end }}
</section>

{{end}}
